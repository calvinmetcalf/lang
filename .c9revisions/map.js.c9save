{"ts":1340797275525,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"google.load('visualization', '1.0', {'packages':['corechart','table']});\r\n$(function() {\r\nvar g = google.maps;\r\nvar zoom;\r\nvar lat;\r\nvar lng;\r\nvar iw = new g.InfoWindow();;\r\nvar ids ={\"out\":\"1ec6BVaXU7xnCawVZvbh22ARd0KQ8bYs1LUMsCfk\",\r\n\"in\":\"1c652Nh2j2SEGsi0ZDRzysEwf_yGEhsrUyC2miUA\",\r\n\"status\":\"\"};\r\nvar l = [\"Spanish\",\"French\",\"French Creole\",\"Italian\",\"Portuguese\",\"Greek\",\"Russian\",\"Polish\",\"Chinese\",\"Korean\",\"Cambodian\",\"Vietnamese\",\"Arabic\"];\r\nvar c = l[0];\r\nvar hash = document.location.hash;\r\nif(!hash){\r\n lat = 42.39405101407922;\r\n lng = -71.21063209765622;\r\n zoom = 8;\r\n ids.status=\"out\";\r\n setHash(zoom,lat,lng);\r\n}else if(!!hash){\r\n   var h = hash.slice(1).split(\"/\");\r\n   zoom = parseInt(h[0]);\r\n   lat = parseFloat(h[1]);\r\n   lng=parseFloat(h[2]);\r\n   c=h[3];\r\n   ids.status=oi(zoom);\r\n};\r\nfunction oi(z){\r\nvar o=\"out\";\r\nif(z>9){\r\no=\"in\" \r\n}\r\nreturn o;\r\n}\r\nfunction setHash(zoom,lat,lng){\r\n  zoom = zoom||m.getZoom();\r\n  lat = lat||m.getCenter().lat();\r\n  lng=lng||m.getCenter().lng();\r\n  hash = \"#\"+zoom+\"/\"+lat+\"/\"+lng+\"/\"+c;\r\n  document.location.hash=hash;\r\n}\r\nfunction changeHash(){\r\n setHash();\r\nchangeStatus();\r\n}\r\n$( \"#tabs\" ).tabs({\r\n    collapsible: true,\r\n    selected: -1\r\n});\r\n          \r\n$( \"input:submit,input:reset\" ).button();\r\n\r\n$('input, textarea').placeholder();\r\n\r\nvar m = new g.Map(document.getElementById('map'), {\r\n    center: new g.LatLng(lat,lng),\r\n    zoom: zoom,\r\n    mapTypeId: 'roadmap'\r\n});\r\ng.event.addListener(m, 'center_changed',changeHash);\r\ng.event.addListener(m, 'zoom_changed',changeHash);\r\nvar mainLayer = new g.FusionTablesLayer({map:m,suppressInfoWindows:true,\r\n      query: {select: 'poly',from: ids[ids.status]},\r\n      styles:getStyle(c)\r\n     });\r\ng.event.addListener(mainLayer,\"click\",infoW);\r\n$('#tabs-2').append('<select id=\"Lang\"></select>');\r\n$.each(l,function(i,k){\r\nif(k==c){\r\n$('#Lang').append(\"<option value='\" +k+\"' selected='selected'>\"+k+\"</option>\"); \r\n}else{\r\n  $('#Lang').append(\"<option value='\" +k+\"'>\"+k+\"</option>\"); \r\n  }\r\n});\r\n $('#Lang').change(function(){\r\n   mainLayer.setMap(null);  \r\n   c=$('#Lang').val();\r\n   mainLayer.setOptions({map:m,suppressInfoWindows:true,\r\n      query: {select: 'poly',from: ids[ids.status]},\r\n      styles:getStyle(c)\r\n     });\r\n      changeHash();\r\n      changeLegend();\r\n });\r\nfunction changeLegend(){\r\n$('#legend').empty().append(\"<b>Percent who speak<br/>\"+c+\" but not English</b><ul><li class='o-lightblue'>Less Then 1%</li><li class='o-darkblue'>1%-2%</li><li class='o-yellow'>2%-3%</li><li class='o-green'>3%-4%</li><li class='o-orange'>4%-6%</li><li class='o-red'>Greater then 6%</li></ul>\");\r\n}\r\nchangeLegend();\r\ngeocoder();\r\nfunction geocoder(geof,addrf,resetf){\r\n    var ozoom = m.getZoom();\r\n    var ocenter = m.getCenter();\r\n    var gc = new g.Geocoder();\r\n    geof = geof||'geocode';\r\n    addrf = addrf||'address';\r\n    resetf = resetf||'resetgeo';\r\n    gc.geomarker = new g.Marker();\r\n    var geoinfo = new g.InfoWindow();\r\n    $('#' + geof).click(function(){\r\n        gc.geocode( { 'address': $(\"#\" + addrf).val()}, function(results, status) {\r\n            if (status == g.GeocoderStatus.OK) {\r\n                var r = results[0];\r\n                m.setCenter(r.geometry.location);\r\n                m.setZoom(14);\r\n                gc.geomarker.content = \"<div class='geoinfo'>Formatted address:<br/>\"+r.formatted_address+\"</div>\";\r\n                gc.geomarker.setPosition(r.geometry.location); \r\n                gc.geomarker.setMap(m);\r\n                g.event.addListener(gc.geomarker, 'click',function(){\r\n                                geoinfo.setContent(gc.geomarker.content);\r\n                              geoinfo.open(m,gc.geomarker);\r\n        \t\t\t\t\t});\r\n            } else {\r\n                alert(\"Geocode was not successful for the following reason: \" + status);\r\n            }\r\n        });\r\n    });\r\n\r\n    $('#' + resetf).click(function(){\r\n        m.setCenter(ocenter);\r\n        m.setZoom(ozoom);\r\n        gc.geomarker.setMap(null);\r\n    });\r\n};\r\nfunction getStyle(c){\r\nreturn [\r\n          {where:\"'Percent \"+c+\"' <0.06\",\r\n           polygonOptions:{\r\n              fillColor:\"#ff9900\"}}\r\n          ,\r\n          {where:\"'Percent \"+c+\"' <0.04\",\r\n           polygonOptions:{\r\n              fillColor:\"#00ff00\"}},\r\n              {where:\"'Percent \"+c+\"' <0.03\",\r\n           polygonOptions:{\r\n              fillColor:\"#ffff00\"}},\r\n          {where:\"'Percent \"+c+\"' <0.02\",\r\n           polygonOptions:{\r\n              fillColor:\"#0000ff\"}},\r\n              {where:\"'Percent \"+c+\"' <0.01\",\r\n           polygonOptions:{\r\n              fillColor:\"#00ffff\"}}\r\n          ];\r\n\r\n}\r\nfunction changeStatus(){\r\nvar z = m.getZoom();\r\nvar s=oi(z);\r\nif(ids.status!=s){\r\nids.status = s;\r\nmainLayer.setOptions({map:m,\r\n      query: {select: 'poly',from: ids[ids.status]},\r\n      styles:getStyle(c)\r\n     });\r\n}\r\n}\r\nfunction infoW(d){\r\n\r\n var e= \"<div id='iwindow'><select id='tog'><option value='chart'>Pie Chart</option><option value='table'>Sortable Grid</option></select><div id='iw'></div></div>\";\r\niw.setOptions({\r\n\r\nmap:m,\r\ncontent:e,\r\nposition:d.latLng}\r\n);\r\ng.event.addListener(iw, 'domready', function() {\r\n\r\nvar r = new google.visualization.DataTable();\r\nr.addColumn('string','Language');\r\nr.addColumn('number','Speakers');\r\nr.addRow(['English',parseInt(d.row['English'].value)]);\r\n$.each(l,function(i,n){\r\nvar p = parseInt(d.row[n].value);\r\nif(p>0){\r\nr.addRow([n,p]);\r\n\r\n}\r\n});\r\n\r\nvar t;\r\nif(d.row.Name){\r\nt=d.row.Name.value;}\r\nelse{\r\nt='Languages';\r\n}\r\nvar o = {'title':t,\r\n                       'width':350,\r\n                       'height':180,\r\n                       'chartArea':{'left':0,\r\n                       'width':'100%',\r\n                       'height':'70%'},\r\n                      'titleTextStyle':{\r\n                      'fontSize':20\r\n                      },\r\n                       'is3D':true};\r\n                       var oo={'width':350,\r\n                       'height':180}\r\n\r\nvar chart = new google.visualization.PieChart(document.getElementById('iw'));\r\n\r\nchart.draw(r,o); \r\nvar table = new google.visualization.Table(document.getElementById('iw'));\r\nvar setInfo = {};\r\nsetInfo.table=function(){\r\nchart.clearChart()\r\ntable.draw(r,oo)\r\n}\r\nsetInfo.chart=function(){\r\ntable.clearChart()\r\nchart.draw(r,o)\r\n}\r\n$('#tog').change(function(){\r\nsetInfo[$('#tog').val()]();\r\n\r\n});\r\n});\r\n}\r\n});\r\n"]],"start1":0,"start2":0,"length1":0,"length2":6344}]],"length":6344}
